From fe6a5084f7c56b8b1771235d1a6ab7b18076e22e Mon Sep 17 00:00:00 2001
From: Maarten Maathuis <madman2003@gmail.com>
Date: Tue, 26 Aug 2008 13:18:58 +0200
Subject: [PATCH 21/36] exa_glyphs: remove useless offset
 (cherry picked from commit ce193476808f54d946351458361c62132d81b62f)

---
 exa/exa_glyphs.c |   13 ++++++-------
 1 files changed, 6 insertions(+), 7 deletions(-)

diff --git a/exa/exa_glyphs.c b/exa/exa_glyphs.c
index 59ef394..b23e7f6 100644
--- a/exa/exa_glyphs.c
+++ b/exa/exa_glyphs.c
@@ -364,7 +364,6 @@ exaGlyphCacheUploadGlyph(ScreenPtr         pScreen,
     ExaPixmapPriv(pGlyphPixmap);
     PixmapPtr pCachePixmap = (PixmapPtr)cache->picture->pDrawable;
     ExaMigrationRec pixmaps[1];
-    int cacheXoff, cacheYoff;
 
     if (!pExaScr->info->UploadToScreen || pExaScr->swappedOut || pExaPixmap->accel_blocked)
 	return FALSE;
@@ -385,8 +384,7 @@ exaGlyphCacheUploadGlyph(ScreenPtr         pScreen,
     pixmaps[0].pReg = NULL;
     exaDoMigration (pixmaps, 1, TRUE);
 
-    pCachePixmap = exaGetOffscreenPixmap ((DrawablePtr)pCachePixmap, &cacheXoff, &cacheYoff);
-    if (!pCachePixmap)
+    if (!exaPixmapIsOffscreen(pCachePixmap))
 	return FALSE;
 
     /* CACHE_{X,Y} are in pixmap coordinates, no need for cache{X,Y}off */
@@ -399,11 +397,12 @@ exaGlyphCacheUploadGlyph(ScreenPtr         pScreen,
 				       pExaPixmap->sys_pitch))
 	return FALSE;
 
+    /* This pixmap should never be bound to a window, so no need to offset coordinates. */
     exaPixmapDirty (pCachePixmap,
-		    CACHE_X(pos) + cacheXoff,
-		    CACHE_Y(pos) + cacheYoff,
-		    CACHE_X(pos) + cacheXoff + pGlyph->info.width,
-		    CACHE_Y(pos) + cacheYoff + pGlyph->info.height);
+		    CACHE_X(pos),
+		    CACHE_Y(pos),
+		    CACHE_X(pos) + pGlyph->info.width,
+		    CACHE_Y(pos) + pGlyph->info.height);
 
     return TRUE;
 }
-- 
1.6.0.3

