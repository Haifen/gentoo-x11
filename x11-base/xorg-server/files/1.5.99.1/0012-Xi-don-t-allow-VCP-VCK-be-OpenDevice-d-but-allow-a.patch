From 9739fac04520e3e0c338f74cedb58855a17fc899 Mon Sep 17 00:00:00 2001
From: Peter Hutterer <peter.hutterer@redhat.com>
Date: Fri, 28 Nov 2008 09:38:49 +1000
Subject: [PATCH] Xi: don't allow VCP/VCK be OpenDevice'd, but allow all SDs.

Reverting to traditional XI behaviour.
---
 Xi/opendev.c |   11 ++---------
 1 files changed, 2 insertions(+), 9 deletions(-)

diff --git a/Xi/opendev.c b/Xi/opendev.c
index c51bb7e..8d24927 100644
--- a/Xi/opendev.c
+++ b/Xi/opendev.c
@@ -99,7 +99,6 @@ ProcXOpenDevice(ClientPtr client)
     int status = Success;
     xOpenDeviceReply rep;
     DeviceIntPtr dev;
-    XIClientPtr pXIClient;
 
     REQUEST(xOpenDeviceReq);
     REQUEST_SIZE_MATCH(xOpenDeviceReq);
@@ -115,14 +114,8 @@ ProcXOpenDevice(ClientPtr client)
     } else if (status != Success)
 	return status;
 
-    /* Don't let XI 1.x clients open devices other than floating SDs. */
-    pXIClient = dixLookupPrivate(&client->devPrivates, XIClientPrivateKey);
-    if (pXIClient->major_version < XI_2_Major)
-    {
-        if (dev->isMaster || (!dev->isMaster && dev->u.master))
-            return BadDevice;
-    }
-
+    if (dev->isMaster)
+        return BadDevice;
 
     OpenInputDevice(dev, client, &status);
     if (status != Success)
-- 
1.6.0.4

