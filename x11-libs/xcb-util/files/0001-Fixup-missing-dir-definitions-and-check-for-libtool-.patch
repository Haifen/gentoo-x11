From 87a901a617b3bf627e0d45dddd8cde312bf02e4f Mon Sep 17 00:00:00 2001
From: Tomas Chvatal <scarabeus@gentoo.org>
Date: Sat, 19 Mar 2011 12:25:49 +0100
Subject: [PATCH] Fixup missing dir definitions and check for libtool and m4.

---
 Makefile.am     |    1 +
 configure.ac    |   17 ++++++++++++-----
 src/Makefile.am |    1 +
 3 files changed, 14 insertions(+), 5 deletions(-)

diff --git a/Makefile.am b/Makefile.am
index 603f904..9e91071 100644
--- a/Makefile.am
+++ b/Makefile.am
@@ -3,6 +3,7 @@ ACLOCAL_AMFLAGS = -I m4
 
 SUBDIRS = src
 
+pkgconfigdir = $(libdir)/pkgconfig
 pkgconfig_DATA =	\
 	xcb-atom.pc	\
 	xcb-aux.pc	\
diff --git a/configure.ac b/configure.ac
index bb15881..044d900 100644
--- a/configure.ac
+++ b/configure.ac
@@ -6,13 +6,20 @@ AC_CONFIG_MACRO_DIR([m4])
 AM_INIT_AUTOMAKE([foreign dist-bzip2])
 AM_MAINTAINER_MODE
 
-XCB_UTIL_M4_WITH_INCLUDE_PATH
-XCB_UTIL_COMMON([1.4], [1.6])
+dnl XCB_UTIL_M4_WITH_INCLUDE_PATH
+dnl XCB_UTIL_COMMON([1.4], [1.6])
+
+AC_PROG_LIBTOOL
+
+AC_CHECK_PROGS(M4, m4, [no])
+AS_IF([test x$M4 = xno],
+	AC_MSG_ERROR([Can't find m4, please install it and try again])
+)
 
 AC_CHECK_PROGS(GPERF, gperf, [no])
-if test $GPERF = "no"; then
-        AC_MSG_ERROR([Can't find gperf, please install it and try again])
-fi
+AS_IF([test $GPERF = xno],
+	AC_MSG_ERROR([Can't find gperf, please install it and try again])
+)
 
 AC_CHECK_FUNCS_ONCE(vasprintf)
 AC_TYPE_SSIZE_T
diff --git a/src/Makefile.am b/src/Makefile.am
index 39ad3bf..ffd0bcf 100644
--- a/src/Makefile.am
+++ b/src/Makefile.am
@@ -11,6 +11,7 @@ libxcb_util_la_SOURCES = \
 	event.c		\
 	xcb_aux.c
 
+xcbincludedir = $(includedir)/xcb
 xcbinclude_HEADERS =	\
 	xcb_util.h	\
 	xcb_atom.h	\
-- 
1.7.4

