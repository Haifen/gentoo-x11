From 3d4239edd2c89d3b67aef11786f0846fba96d718 Mon Sep 17 00:00:00 2001
From: Alexey Shvetsov <alexxy@gentoo.org>
Date: Sun, 3 Jun 2012 04:35:51 +0400
Subject: [PATCH 3/3] clover fix building and add standart locations for
 libclc

---
 src/gallium/state_trackers/clover/llvm/invocation.cpp |    4 ++--
 src/gallium/targets/opencl/Makefile.am                |    1 +
 2 files changed, 3 insertions(+), 2 deletions(-)

diff --git a/src/gallium/state_trackers/clover/llvm/invocation.cpp b/src/gallium/state_trackers/clover/llvm/invocation.cpp
index 27276bc..78c8670 100644
--- a/src/gallium/state_trackers/clover/llvm/invocation.cpp
+++ b/src/gallium/state_trackers/clover/llvm/invocation.cpp
@@ -107,7 +107,7 @@ namespace {
       c.getHeaderSearchOpts().ResourceDir = CLANG_RESOURCE_DIR;
 
       // Add libclc generic search path
-      c.getHeaderSearchOpts().AddPath(LIBCLC_PATH "/generic/include/",
+      c.getHeaderSearchOpts().AddPath(LIBCLC_PATH "/include/",
                                       clang::frontend::Angled,
                                       false, false, false);
 
@@ -142,7 +142,7 @@ namespace {
       llvm::Linker linker("clover", mod);
 
       // Link the kernel with libclc
-      linker.LinkInFile(llvm::sys::Path(LIBCLC_PATH + triple + "/lib/builtins.bc"), isNative);
+      linker.LinkInFile(llvm::sys::Path(LIBCLC_PATH + "/lib/clc/" +triple + "/builtins.bc"), isNative);
       mod = linker.releaseModule();
 
       // Run link time optimizations
diff --git a/src/gallium/targets/opencl/Makefile.am b/src/gallium/targets/opencl/Makefile.am
index d55b21e..4c89e36 100644
--- a/src/gallium/targets/opencl/Makefile.am
+++ b/src/gallium/targets/opencl/Makefile.am
@@ -3,6 +3,7 @@ AUTOMAKE_OPTIONS = subdir-objects
 lib_LTLIBRARIES = libOpenCL.la
 
 libOpenCL_la_LDFLAGS = \
+	$(LLVM_LDFLAGS) \
 	-version-number 1:0
 
 libOpenCL_la_LIBADD = \
-- 
1.7.10.2

